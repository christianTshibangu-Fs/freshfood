{% extends "base.html" %}

{% block content %}

<div class="space-y-10">
    
    <!-- Lien de Retour à l'Accueil (Nouveau) -->
    <div class="mb-6">
        <a href="{% url 'index-app' %}" class="inline-flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 transition duration-150">
            <i class="fa-solid fa-arrow-left mr-2"></i>
            Retour à l'Accueil
        </a>
    </div>

    <div class="p-6 bg-white rounded-xl shadow-2xl border-l-4 border-indigo-600 flex justify-between items-center">
        <div>
            <h1 class="text-4xl font-extrabold text-gray-900 flex items-center">
                <i class="fa-solid fa-gauge-high mr-3 text-indigo-600"></i> 
                Tableau de Bord Administrateur
            </h1>
            <p class="mt-2 text-lg text-gray-600">
                Aperçu rapide des métriques clés de l'application Food App.
            </p>
            <p class="mt-4 text-sm text-gray-500">
                Connecté en tant que: <span class="font-semibold text-indigo-700">{{ user.username }}</span>
            </p>
        </div>

        <!-- Bouton d'Action (Nouveau Produit) -->
        <a href="{% url 'product-create' %}" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-105 flex items-center whitespace-nowrap">
            <i class="fa-solid fa-plus mr-2"></i>
            Créer un nouveau produit
        </a>
    </div>

    <!-- 1. Cartes de Statistiques Clés -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <!-- Carte: Nombre Total de Produits -->
        <div class="stat-card bg-white hover:shadow-indigo-300">
            <div class="stat-icon bg-indigo-100 text-indigo-600">
                <i class="fa-solid fa-carrot"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Total Produits</p>
                <p class="text-3xl font-bold text-gray-900">{{ total_products }}</p>
            </div>
        </div>

        <!-- Carte: Nombre Total de Commandes -->
        <div class="stat-card bg-white hover:shadow-green-300">
            <div class="stat-icon bg-green-100 text-green-600">
                <i class="fa-solid fa-box-open"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Total Commandes</p>
                <p class="text-3xl font-bold text-gray-900">{{ total_orders }}</p>
            </div>
        </div>

        <!-- Carte: Total d'Articles Commandés -->
        <div class="stat-card bg-white hover:shadow-yellow-300">
            <div class="stat-icon bg-yellow-100 text-yellow-600">
                <i class="fa-solid fa-basket-shopping"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Articles Commandés</p>
                <p class="text-3xl font-bold text-gray-900">{{ total_order_articles }}</p>
            </div>
        </div>
    </div>
    
    <!-- Styles pour les Cartes de Statistiques -->
    <style>
        .stat-card {
            @apply flex items-center space-x-4 p-6 rounded-xl shadow-xl transition duration-300 transform hover:scale-[1.02] border border-gray-100;
        }
        .stat-icon {
            @apply flex items-center justify-center h-12 w-12 rounded-full text-xl flex-shrink-0 shadow-lg;
        }
    </style>


    <!-- 2. Aperçus Récents (Grid 2 Colonnes) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Aperçu des Commandes Récentes -->
        <div class="bg-white p-6 rounded-xl shadow-2xl border border-gray-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center border-b pb-2">
                <span class="flex items-center">
                    <i class="fa-solid fa-receipt mr-2 text-green-500"></i> Commandes Récentes
                </span>
                <!-- Lien pour visualiser toutes les commandes (Nouveau) -->
                <a href="{% url 'order-list' %}" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition duration-150">Voir tout <i class="fa-solid fa-arrow-right ml-1"></i></a>
            </h2>
            
            <ul class="divide-y divide-gray-100">
                {% for order in recent_orders %}
                <li class="py-3 flex justify-between items-center hover:bg-gray-50 transition duration-150 px-2 rounded-lg">
                    <div>
                        <p class="text-sm font-semibold text-gray-700">Commande #{{ order.id }}</p>
                        <!-- Affichage du nom de l'utilisateur (Confirmé) -->
                        <p class="text-xs text-gray-500">Par: <span class="font-medium text-gray-800">{{ order.customer.username|default:"Utilisateur Anonyme" }}</span></p>
                    </div>
                    <div class="text-right">
                        <!-- Formatage hypothétique du prix -->
                        <p class="text-md font-bold text-green-600">{{ order.get_total_price|floatformat:2|default:"0.00" }} CDF</p>
                        <p class="text-xs text-gray-400">{{ order.created_at|date:"d M Y H:i" }}</p>
                    </div>
                </li>
                {% empty %}
                <li class="text-center py-4 text-gray-500 italic">Aucune commande récente trouvée.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Aperçu des Produits Récents -->
        <div class="bg-white p-6 rounded-xl shadow-2xl border border-gray-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center border-b pb-2">
                <span class="flex items-center">
                <i class="fa-solid fa-kitchen-set mr-2 text-indigo-500"></i> Nos Produits
                </span>
                <!-- Lien pour visualiser tous les produits (Nouveau) -->
                <a href="{% url 'product-list' %}" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition duration-150">Voir tout <i class="fa-solid fa-arrow-right ml-1"></i></a>
            
            </h2>
            
            <ul class="divide-y divide-gray-100">
                {% for product in recent_products %}
                <li class="py-3 flex justify-between items-center hover:bg-gray-50 transition duration-150 px-2 rounded-lg">
                    <div>
                        <p class="text-sm font-semibold text-gray-700">{{ product.label }}</p>
                        <!-- Supposons que l'objet Product a un champ 'description' et 'price' -->
                        <p class="text-xs text-gray-500 truncate max-w-xs">{{ product.description|default:"Pas de description"|slice:":50" }}...</p>
                    </div>
                    <div class="text-right">
                         <p class="text-md font-bold text-indigo-600">{{ product.price|default:"N/A" }} CDF</p>
                    </div>
                </li>
                {% empty %}
                <li class="text-center py-4 text-gray-500 italic">Aucun nouveau produit trouvé.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    
</div>

{% endblock content %}